import type { InstallmentOption, Invoice, Money } from './types';

const usd = (amount: number): Money => ({ amount, currencyCode: 'USD' });

const INSTALLMENT_PLANS: Record<string, InstallmentOption[]> = {
  'comp-blue-hollow': [
    {
      id: 'bh-plan-3',
      label: '3 monthly payments',
      durationMonths: 3,
      aprPercent: 4.2,
    },
    {
      id: 'bh-plan-6',
      label: '6 monthly payments',
      durationMonths: 6,
      aprPercent: 6.5,
      minimumOrderAmount: usd(25_000),
    },
  ],
};

export const INVOICES: Invoice[] = [
  {
    id: 'inv-2024-0089',
    invoiceNumber: 'INV-2024-0089',
    companyId: 'comp-blue-hollow',
    quoteId: 'quote-2024-0102',
    orderId: 'ORD-4821',
    status: 'due',
    issuedAt: '2024-07-22T10:00:00Z',
    dueAt: '2024-08-21T23:59:00Z',
    subtotal: usd(18_450),
    taxTotal: usd(1_476),
    shippingTotal: usd(540),
    total: usd(20_466),
    amountPaid: usd(10_233),
    balanceDue: usd(10_233),
    paymentTerms: {
      type: 'installments',
      description: '6-month seasonal plan via ACH autopay',
      installmentOptions: INSTALLMENT_PLANS['comp-blue-hollow'],
      creditLimit: usd(200_000),
    },
    paymentSchedule: INSTALLMENT_PLANS['comp-blue-hollow'],
    lineItems: [
      {
        id: 'inv-0089-1',
        productId: 'prod-lux-linens',
        title: 'Luxury Linen Set',
        sku: 'LIN-SET-SEASONAL',
        quantity: 60,
        unitPrice: usd(190),
        total: usd(11_400),
      },
      {
        id: 'inv-0089-2',
        productId: 'prod-spa-kits',
        title: 'Spa Amenity Kit',
        sku: 'SPA-KIT-WINTER',
        quantity: 200,
        unitPrice: usd(24),
        total: usd(4_800),
      },
      {
        id: 'inv-0089-3',
        productId: 'prod-outdoor-heaters',
        title: 'Outdoor Infrared Heater',
        sku: 'INF-HEAT-XL',
        quantity: 15,
        unitPrice: usd(165),
        total: usd(2_475),
      },
      {
        id: 'inv-0089-4',
        productId: 'prod-custom-signage',
        title: 'Custom Resort Signage Package',
        sku: 'SIGN-PKG',
        quantity: 1,
        unitPrice: usd(1_775),
        total: usd(1_775),
      },
    ],
    payments: [
      {
        id: 'payment-0089-1',
        method: 'ach',
        amount: usd(10_233),
        processedAt: '2024-07-25T12:30:00Z',
        reference: 'ACH-653291',
      },
    ],
    notes: 'Auto-payments scheduled monthly. Reminder to sync to ERP when paid in full.',
  },
  {
    id: 'inv-2024-0094',
    invoiceNumber: 'INV-2024-0094',
    companyId: 'comp-abstract-industrial',
    quoteId: 'quote-2024-0156',
    status: 'draft',
    issuedAt: '2024-09-11T10:45:00Z',
    dueAt: '2024-10-11T23:59:00Z',
    subtotal: usd(7_020),
    taxTotal: usd(585.6),
    shippingTotal: usd(180),
    total: usd(7_785.6),
    amountPaid: usd(0),
    balanceDue: usd(7_785.6),
    paymentTerms: {
      type: 'net',
      netDays: 30,
      discountPercent: 2,
      description: 'Net 30 with 2% ten-day discount',
      creditLimit: usd(150_000),
    },
    lineItems: [
      {
        id: 'inv-0094-1',
        productId: 'prod-industrial-degreaser',
        title: 'Industrial Degreaser – 55 gal drum',
        sku: 'DEG-55-IND',
        quantity: 4,
        unitPrice: usd(950),
        total: usd(3_800),
      },
      {
        id: 'inv-0094-2',
        productId: 'prod-thermal-gloves',
        title: 'Thermal Safety Gloves (case of 24)',
        sku: 'TSG-24',
        quantity: 5,
        unitPrice: usd(210),
        total: usd(1_050),
      },
      {
        id: 'inv-0094-3',
        productId: 'prod-pressure-hose',
        title: 'High-Pressure Hose Kit',
        sku: 'HPH-10',
        quantity: 10,
        unitPrice: usd(217),
        total: usd(2_170),
      },
    ],
    payments: [],
    notes: 'Pending approval. Convert to posted invoice once quote is approved.',
  },
  {
    id: 'inv-2024-0095',
    invoiceNumber: 'INV-2024-0095',
    companyId: 'comp-abstract-industrial',
    quoteId: 'quote-2024-0168',
    orderId: 'ORD-5021',
    status: 'due',
    issuedAt: '2024-10-01T09:15:00Z',
    dueAt: '2024-10-31T23:59:00Z',
    subtotal: usd(6_134.4),
    taxTotal: usd(490.75),
    shippingTotal: usd(120),
    total: usd(6_745.15),
    amountPaid: usd(0),
    balanceDue: usd(6_745.15),
    paymentTerms: {
      type: 'net',
      netDays: 30,
      description: 'Standard net 30 terms for replenishment orders',
      creditLimit: usd(150_000),
    },
    lineItems: [
      {
        id: 'inv-0095-1',
        productId: 'prod-angle-grinder',
        title: 'Heavy-duty angle grinder',
        sku: 'ANG-GRD-850',
        quantity: 12,
        unitPrice: usd(189),
        total: usd(2_268),
      },
      {
        id: 'inv-0095-2',
        productId: 'prod-led-worklight',
        title: 'LED worklight tower',
        sku: 'LED-WORK-TR',
        quantity: 8,
        unitPrice: usd(330),
        total: usd(2_640),
      },
    ],
    payments: [],
    notes: 'Tool crib replenishment order. Candidate for inclusion in next pay run.',
  },
  {
    id: 'inv-2024-0096',
    invoiceNumber: 'INV-2024-0096',
    companyId: 'comp-abstract-industrial',
    status: 'partial',
    issuedAt: '2024-08-01T11:20:00Z',
    dueAt: '2024-09-01T23:59:00Z',
    subtotal: usd(12_400),
    taxTotal: usd(992),
    shippingTotal: usd(0),
    total: usd(13_392),
    amountPaid: usd(6_696),
    balanceDue: usd(6_696),
    paymentTerms: {
      type: 'net',
      netDays: 30,
      description: 'Net 30 with mid-month partial payments',
      creditLimit: usd(150_000),
    },
    lineItems: [
      {
        id: 'inv-0096-1',
        productId: 'prod-shop-shelving',
        title: 'Adjustable Shop Shelving',
        sku: 'SHELF-ADJ',
        quantity: 20,
        unitPrice: usd(340),
        total: usd(6_800),
      },
      {
        id: 'inv-0096-2',
        productId: 'prod-led-task',
        title: 'LED Task Light Kit',
        sku: 'LED-TASK-SET',
        quantity: 50,
        unitPrice: usd(112),
        total: usd(5_600),
      },
    ],
    payments: [
      {
        id: 'payment-0096-1',
        method: 'ach',
        amount: usd(6_696),
        processedAt: '2024-08-15T14:10:00Z',
        reference: 'ACH-884120',
      },
    ],
    notes: 'First half of balance paid via ACH. Remaining balance will be scheduled into next pay run.',
  },
  {
    id: 'inv-2024-0097',
    invoiceNumber: 'INV-2024-0097',
    companyId: 'comp-abstract-industrial',
    status: 'paid',
    issuedAt: '2024-06-05T10:00:00Z',
    dueAt: '2024-07-05T23:59:00Z',
    paidAt: '2024-06-20T16:45:00Z',
    subtotal: usd(4_250),
    taxTotal: usd(340),
    shippingTotal: usd(90),
    total: usd(4_680),
    amountPaid: usd(4_680),
    balanceDue: usd(0),
    paymentTerms: {
      type: 'due_on_receipt',
      description: 'Due on receipt for rush maintenance orders',
      creditLimit: usd(150_000),
    },
    lineItems: [
      {
        id: 'inv-0097-1',
        productId: 'prod-pressure-hose',
        title: 'High-Pressure Hose Kit',
        sku: 'HPH-10',
        quantity: 8,
        unitPrice: usd(217),
        total: usd(1_736),
      },
      {
        id: 'inv-0097-2',
        productId: 'prod-thermal-gloves',
        title: 'Thermal Safety Gloves (case of 24)',
        sku: 'TSG-24',
        quantity: 8,
        unitPrice: usd(210),
        total: usd(1_680),
      },
      {
        id: 'inv-0097-3',
        productId: 'prod-hard-hat',
        title: 'Hard hat with LED light',
        sku: 'HH-LED-02',
        quantity: 10,
        unitPrice: usd(83.4),
        total: usd(834),
      },
    ],
    payments: [
      {
        id: 'payment-0097-1',
        method: 'check',
        amount: usd(4_680),
        processedAt: '2024-06-20T16:45:00Z',
        reference: 'CHK-22104',
      },
    ],
    notes: 'Paid in full via check. Use as an example of completed lifecycle.',
  },
  {
    id: 'inv-2024-0067',
    invoiceNumber: 'INV-2024-0067',
    companyId: 'comp-lynx-supply',
    status: 'overdue',
    issuedAt: '2024-04-12T09:00:00Z',
    dueAt: '2024-05-12T23:59:00Z',
    subtotal: usd(6_780),
    taxTotal: usd(542.4),
    shippingTotal: usd(0),
    total: usd(7_322.4),
    amountPaid: usd(3_000),
    balanceDue: usd(4_322.4),
    paymentTerms: {
      type: 'net',
      netDays: 30,
      creditLimit: usd(80_000),
      description: 'Standard net 30 terms pending renewal',
    },
    lineItems: [
      {
        id: 'inv-0067-1',
        productId: 'prod-shop-shelving',
        title: 'Adjustable Shop Shelving',
        sku: 'SHELF-ADJ',
        quantity: 12,
        unitPrice: usd(340),
        total: usd(4_080),
      },
      {
        id: 'inv-0067-2',
        productId: 'prod-led-task',
        title: 'LED Task Light Kit',
        sku: 'LED-TASK-SET',
        quantity: 30,
        unitPrice: usd(90),
        total: usd(2_700),
      },
    ],
    payments: [
      {
        id: 'payment-0067-1',
        method: 'card',
        amount: usd(3_000),
        processedAt: '2024-04-28T17:15:00Z',
        reference: 'VISA-9542',
      },
    ],
    notes: 'Send dunning reminder. Customer requested ACH payment extension.',
    exceptions: [
      {
        id: 'ex-inv-0067-payment-1',
        type: 'payment',
        status: 'open',
        openedAt: '2024-05-20T09:00:00Z',
        summary: 'Overdue balance on installment-style net terms.',
        rootCause: 'Customer requested extension beyond standard net 30.',
        owner: 'Finance – AR',
        relatedLineItemIds: ['inv-0067-1', 'inv-0067-2'],
      },
      {
        id: 'ex-inv-0067-pricing-1',
        type: 'pricing',
        status: 'resolved',
        openedAt: '2024-05-01T10:00:00Z',
        resolvedAt: '2024-05-03T14:30:00Z',
        summary: 'Volume discount incorrectly omitted on LED task lights.',
        rootCause: 'Tiered pricing rule misconfigured in ERP.',
        owner: 'Pricing ops',
        relatedLineItemIds: ['inv-0067-2'],
      },
    ],
  },
];

export const getInvoicesForCompany = (companyId: string): Invoice[] =>
  INVOICES.filter((invoice) => invoice.companyId === companyId);

export const getInvoiceById = (invoiceId: string): Invoice | undefined =>
  INVOICES.find((invoice) => invoice.id === invoiceId);

export function markInvoicesScheduledForPayRun(
  invoiceIds: string[],
  plannedPaymentDate: string,
  payRunId: string,
): void {
  INVOICES.forEach((invoice) => {
    if (invoiceIds.includes(invoice.id)) {
      invoice.plannedPaymentDate = plannedPaymentDate;
      invoice.plannedPayRunId = payRunId;
    }
  });
}
